# Rime schema
# encoding: utf-8

schema:
  schema_id: phuagthucdsis
  name: 仿羅馬通字方案
  version: "2022.02.7"
  author:
    - GwaiSyen <domgleisyen@foxmail.com>
  description: |
    基于廣韻音系，參攷上古擬音
    韻典網·廣韻 http://ytenx.org/kyonh/
    https://zhuanlan.zhihu.com/p/388867479仿羅馬通字方案
  dependencies:
    - luna_pinyin

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: half_shape
    states: [ 全角, 半角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - script_translator
    - reverse_lookup_translator
    - encode_commit_history
  filters:
    - simplifier
    - uniquifier

speller:
  alphabet: zyxwvutsrqponmlkjihgfedcbaABCDEFGHIJKLMNOPQRSTUVWXYZ
  delimiter: "'"
  algebra:
    - derive/((^|')([PBTDKGNLMXJS])(?!$))/\L$1\L/
    - derive/((^|')(([PTK]|TS|RT)H)(?!$))/\L$1\L/
    - derive/(^|')T[SZ](?!$)/ts/
    - derive/(^|')D[SZ](?!$)/dz/
    # - derive/((^|')([TD][SZCR])(?!$))/\L$1\L/
    - derive/((^|')([SZ][SC]))(?!$)/\L$1\L/
    # - derive/((^|')([H][QZS])(?!$))/\L$1\L/
    - derive/(^|')HQ(?!$)/q/
    - derive/(^|')HZ(?!$)/g/
    - derive/(^|')HS(?!$)/h/
    - derive/(^|')T[SZ]H(?!$)/v/
    - derive/(^|')T[SZ](?!$)/c/
    - derive/(^|')D[SZ](?!$)/z/
     - derive/(^|')SS(?!$)/s/
    - derive/(^|')(SZ|ZS)(?!$)/x/
    - derive/(^|')NG(?!$)/w/
    - derive/(^|')KH(?!$)/y/
    - derive/(^|')PH(?!$)/f/
    - derive/(^|')T[RC]?H(?!$)/r/
    - derive/(^|')T[RC](?!$)/t/
    - derive/(^|')D[RC](?!$)/d/
    - derive/(^|')N[RC](?!$)/n/
    - derive/(^|')SC([jy][ie])(?!$)/$1h$2/
    - derive/(^|')ZC([jy][ie])(?!$)/$1g$2/

    - derive/^T[ZC]H(?!$)/RTH/
    - derive/^D[ZC](?!$)/RT/
    - derive/^T[ZC]H(?!$)/RD/
    - derive/^S[SC](?!$)/RS/
    - derive/^Z[SC](?!$)/RZ/

    - derive/^([A-Z]+)([\w])+$/$1/
    - abbrev/^([a-z])([a-gi-z])+$/$1/
##############
    - derive/((^|')([pfbm]))v/$1/
    - derive/(\w)jao([cgqk])/$1xe$2/
    - derive/(\w)yao([cgqk])/$1we$2/
    - derive/(\w)jao(([osh])|$)/$1ja$2/
    - derive/(\w)jeo/$1i/
    - derive/(\w[rl])eo/$1i/
    - derive/(\w)xeo/$1ri/
    - derive/(\w)xeo/$1li/
    - derive/(\w)yeo/$1vi/
    - derive/(\w)yeo([^cgqk])/$1u$2/
    - derive/(\w)eo([^cgqk])/$1o$2/ 
    - derive/(\wv)eo([cgqk])/$1o$2/ #veo
    - derive/(\w)eo([hsuvw]|$)/$1i$2/ #㞢尤
    - derive/(\w)u([uvw])/$1o$2/ #侯
    - derive/(\w)ji([uvw])/$1reo$2/ #幽
    - derive/(\w)ji([uvw])/$1ri$2/ #幽
    - derive/(\w)i([ao])/$1j$2/ 
    - derive/(\w)u([ao])/$1y$2/
    - derive/(\w)ou/$1j$/
    - derive/(\w[jyxw])i/$1/
    - derive/(\w)[jx]([ie])/$1i$2/
    - derive/(\w)[yw]([ie])/$1u$2/

# 韻尾-聲調
    - derive/(\w)l$/$1i/
    - erase/(?<!^)([hs])$/$1/
    - derive/(\w)r$/$1y/
    - derive/(\w)q$/$1x/
    - derive/([aeiou])$/$1$1/
    # - derive/([aeiou]){2}$/$1/
###############
    # - derive/^[A-Z]+[vrljyxwiu]?ao([a-z])$/AO/ # 麻瓜衺敗夬肴銜刪彎庚觥京榮
    # - derive/^[A-Z]+[iuxw]a([a-z])$/IA/ # 乂皆嚴言咸昜
    # - derive/^[A-Z]+[uw]a([a-z])$/UA/ #  廢乖凡元方
    # - derive/^[A-Z]+[rl]e([a-z])$/AE/ #  佳媧皆乖咸山鰥耕宏
    # - derive/^[A-Z]+([jyxw]e([a-z])$|ao[cgqk]$)/EA/ #  支垂奇規祭銳例衞幖宵鹽淹仙宣乾權淸瓊京榮
    # - derive/^[A-Z]+([vrljyxwiu]?eo|u[uvw])([a-z])$/EO/ # 㞢魚依微咍灰侯覃痕魂登弘
    # - derive/^[A-Z]+([vrljyxwiu]?eo[ljyuvwmbfp]|ro[cgqk]|[ix]o)$/OA/ #[魚咍灰豪覃江]
    # - derive/^[A-Z]+(ro[cgqk]|[ix]o|ra[uvw])$/OE/ #[魚肴江] 
    # - derive/^[A-Z]+[ix]o([a-z])$/IO/ # [魚鍾]
    # - derive/^[A-Z]+[uw]o([a-z])$/UO/ # [虞]
    # - derive/^[A-Z]+[jx]i[uvw]([a-z])$/IU/ # [幽]
    # - derive/^[A-Z]+[rljyxw]eo([a-z])$/IE/ # [㞢依尤欣蒸]
    # - derive/^[A-Z]+[yw]AO([a-z])$/UE/ # [微文職]
    # - derive/^[A-Z]+([v]?a([a-z])|[ia]a)$/A/ # [歌戈迦瘸泰外豪談寒桓唐荒]
    # - derive/^[A-Z]+[v]?(o([a-z])|vEO[ljyndzt])$/O/ # [模灰魂冬鍾]
    # - derive/^[A-Z]+[v]?e([a-z])$/E/ #齊圭簫添先涓靑冋
    # - derive/^[A-Z]+[jx]?u([a-z])$/U/ #[侯東中]
    # - derive/^[A-Z]+[ljyxw]?i([a-z])$/I/ #[脂錐龜肌幽侵愔眞純鄰輪]

    # - derive/^[A-Z]+[vrljyxwiu]?ao/AO/ # 麻瓜衺敗夬肴銜刪彎庚觥京榮
    # - derive/^[A-Z]+[iuxw]a/IA/ # 乂皆嚴言咸昜
    # - derive/^[A-Z]+[uw]a/UA/ #  廢乖凡元方
    # - derive/^[A-Z]+[rl]e/AE/ #  佳媧皆乖咸山鰥耕宏
    # - derive/^[A-Z]+([jyxw]e|ao(?=[cgqk]))/EA/ #  支垂奇規祭銳例衞幖宵鹽淹仙宣乾權淸瓊京榮
    # - derive/^[A-Z]+([vrljyxwiu]?eo|u(?=[uvw]))/EO/ # 㞢魚依微咍灰侯覃痕魂登弘
    # - derive/^[A-Z]+([vrljyxwiu]?eo(?=[ljyuvwmbfp])|ro(?=[cgqk])|[ix]o)/OA/ #[魚咍灰豪覃江]
    # - derive/^[A-Z]+(ro(?=[cgqk])|[ix]o|ra(?=[uvw]))/OE/ #[魚肴江] 
    # - derive/^[A-Z]+[ix]o/IO/ # [魚鍾]
    # - derive/^[A-Z]+[uw]o/UO/ # [虞]
    # - derive/^[A-Z]+[jx]i(?=[uvw])/IU/ # [幽]
    # - derive/^[A-Z]+[rljyxw]eo/IE/ # [㞢依尤欣蒸]
    # - derive/^[A-Z]+[yw]AO/UE/ # [微文職]
    # - derive/^[A-Z]+([v]?a|[ia]a)/A/ # [歌戈迦瘸泰外豪談寒桓唐荒]
    # - derive/^[A-Z]+[v]?(o|vEO(?=[ljyndzt]))/O/ # [模灰魂冬鍾]
    # - derive/^[A-Z]+[v]?e/E/ #齊圭簫添先涓靑冋
    # - derive/^[A-Z]+[jx]?u/U/ #[侯東中]
    # - derive/^[A-Z]+[ljyxw]?i/I/ #[脂錐龜肌幽侵愔眞純鄰輪]

translator:
  dictionary: phuagthucdsis
  spelling_hints: 8
  prism: phuagthucdsis
  preedit_format:
    # - xform/(^|[' ])r/$1tʰ/
    # - xform/(^|[' ])f/$1pʰ/
    # - xform/(^|[' ])y/$1kʰ/
    # - xform/(^|[' ])v/$1cʰ/
    # - xform/(^|[' ])w/$1ŋ/
    # - xform/([\w])h($|[' ])/$1ʔ$2/

reverse_lookup:
  dictionary: luna_pinyin
  prefix: "i"
  suffix: "'"
  tips: 〔拼音〕
  preedit_format:
    # - xform/([nl])v/$1ü/
    # - xform/([nl])ue/$1üe/
    # - xform/([jqxy])v/$1u/

punctuator:
  half_shape:
    "`": ["`", "·"]
    "~": ["~", "~"]
    "!": [ "!","！"]
    "@": ["@", "＠", "☯"]
    "#": ["#", "＃", "⌘"]
    "$": ["$", "￥", "€", "£", "¥", "¢", "¤"]
    "%": ["%", "％", "°", "℃"]
    "^": ["^", "……", "↑"]
    "&": ["&", "∩","∧", "＆"]
    "*": ["*", "×", "∙", "∏", "∐", "∘", "・", "⊙", "※", "❂", "＊"]
    "(": ["(", "（"]
    ")": [")", "）"]
    "-": ["-", "−", "∖", "－"]
    "_": ["_", "——"]
    "=": ["=", "＝"]
    "+": ["+", "∫", "∑", "⨋", "＋"]
    "[": ["[", "「", "【", "〔", "［" ]
    "]": ["]", "」", "】", "〕", "］"]
    "{": ["{", "『", "〖", "｛"]
    "}": ["}", "』", "〗", "｝"]
    ":": [":", "："]
    ";": [";", "；"]

    "|": ["|", "∪"," ∨", "¦", "§", "｜"]
    "\\": ["\\", "、", "＼"]
    "\'": ["\'", "‘", "’"] # ' 
    "\"": ["\"", "“”"] # '"
    "<": ["<", "《", "〈", "«", "‹", "←", "∈", "⊆", "⊊", "⊈"]
    ">": [">", "》", "〉", "»", "›", "→", "∋", "⊇", "⊋", "⊉"]
    ",": ["," ,  "，"]
    ".": ["." ,  "。"]
    "?": ["?" ,"∞" , "？"]
    "/": ["/", "∕"  , "\\",  "、", "÷", "／"]
    
  full_shape:
    "(": ["(", "（"]
    ")": [")", "）"]
    "<": ["《", "〈", "«", "‹", "←"]
    ">": ["》", "〉", "»", "›", "→"]

key_binder:
  import_preset: default
ascii_composer:
    good_old_caps_lock: true
    switch_key: {Caps_Lock: noop, Control_L: noop, Control_R: noop, Eisu_toggle: clear, Shift_L: commit_code, Shift_R: commit_code}

recognizer:
  import_preset: default
  patterns:
    reverse_lookup: "i[a-z]*'?$"
