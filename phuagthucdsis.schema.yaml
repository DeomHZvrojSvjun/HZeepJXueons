# Rime schema
# encoding: utf-8

schema:
  schema_id: phuagthucdsis
  name: 仿羅馬通字方案
  version: "2022.02.7"
  author:
    - GwaiSyen <domgleisyen@foxmail.com>
  description: |
    基于廣韻音系，參攷上古擬音
    韻典網·廣韻 http://ytenx.org/kyonh/
    https://zhuanlan.zhihu.com/p/388867479仿羅馬通字方案
  dependencies:
    - luna_pinyin
    - unicode
    - zyenpheng

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: half_shape
    states: [ 全角, 半角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@pinyin
    - affix_segmentor@zyenpheng
    - affix_segmentor@unicode
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - script_translator
    - script_translator@pinyin
    - script_translator@zyenpheng
    - table_translator@unicode
    - encode_commit_history
  filters:
    - simplifier
    - uniquifier
    - cjk_minifier
    - reverse_lookup_filter@gepxuuz

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcbaABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789;'
  delimiter: "'"
  algebra:
    - derive/(^|')F//
    - derive/((^|')([PBMTDNLKGSJX])(?!$))/\L$1\L/
    - derive/((^|')(([PTK]|TS|RT)H)(?!$))/\L$1\L/
    - derive/(^|')T[SZ](?!$)/ts/
    - derive/(^|')D[SZ](?!$)/dz/
    # - derive/((^|')([TD][SZCR])(?!$))/\L$1\L/
    - derive/((^|')([SZ][SC]))(?!$)/\L$1\L/
    # - derive/((^|')([H][QZS])(?!$))/\L$1\L/
    - derive/(^|')T[SZ]H(?!$)/v/
    - derive/(^|')T[SZ](?!$)/c/
    - derive/(^|')D[SZ](?!$)/z/
    - derive/(^|')SS(?!$)/s/  
    - derive/(^|')(SZ|ZS)(?!$)/j/
    - derive/(^|')NG(?!$)/ng/
    - derive/(^|')Q(?!$)/k/
    - derive/(^|')HQ(?!$)/q/
    - derive/(^|')HZ(?!$)/g/
    - derive/(^|')HS(?!$)/h/
    - derive/(^|')NG(?!$)/w/
    - derive/(^|')[KQ]H(?!$)/y/
    - derive/(^|')PH(?!$)/f/
    - derive/(^|')T[RC]?H(?!$)/r/
    - derive/(^|')T[RC](?!$)/t/
    - derive/(^|')D[RC](?!$)/d/
    - derive/(^|')N[RC](?!$)/n/
    - erase/(^|')[hg][jy]/
    - erase/(^|')H[SZ][jy]/
    - derive/(^|')HSj/$1hx/
    - derive/(^|')HZj/$1gx/
    - derive/(^|')HSy/$1hw/
    - derive/(^|')HZy/$1gw/
    - derive/(^|')SC([jy])(?!$)/$1h$2/
    - derive/(^|')ZC([jy])(?!$)/$1g$2/
    # - abbrev/(^|')SC(\w)(?!$)/$1h$2/
    # - abbrev/(^|')ZC(\w)(?!$)/$1g$2/
    # - derive/^T[ZC]H(?!$)/RTH/
    # - derive/^D[ZC](?!$)/RT/
    # - derive/^T[ZC]H(?!$)/RD/
    # - derive/^S[SC](?!$)/RS/
    # - derive/^Z[SC](?!$)/RZ/
    - derive/^([A-Z]+)([\w])+$/$1/
    # - abbrev/^([a-z])([a-gi-z])+$/$1/
    - derive/(\w)x$/$1/ # 韻尾-聲調
    - derive/(\w)jh$/$1l/
    - derive/(\w)js$/$1r/
    - derive/(\w)vh$/$1w/
    - derive/(\w)vs$/$1y/
    - derive/(\w[rs])[jptk]$/$1/
    - abbrev/(\w)j?[rs][jptk]$/$1r/
    - abbrev/(\w)j?[rs][jptk]$/$1s/


  
    - derive/(\w)([ev]a)j/$1$2/ #AJ

    - derive/([A-Z])y(\w)/$1vj$2/#介音
    - derive/([A-Z])l(\w)/$1vr$2/
    - derive/([A-Z])x(\w)/$1rj$2/
    - derive/([A-Z])w(\w)/$1vx$2/

    - derive/([pfbm])v/$1/ #幫組
    - derive/([pfbm])u([aeiouə])/$1i$2/ 
    - derive/([pfbm])y/$1j/ 
    - derive/([pfbm])w/$1x/ 

    - derive/(\w)v(əu[xhs])/$1$2/ #O U
    - derive/(\w)l([u][xhs])/$1r$2/
    - derive/(\w)u([u][xhs])/$1i$2/
    - derive/(\w)y([u][xhs])/$1j$2/
    - derive/(\w)w([u][xhs])/$1x$2/

    - derive/(\w)v([ou][^xhs])/$1$2/ #O U
    - derive/(\w)l([ou][^xhs])/$1r$2/
    - derive/(\w)u([ou][^xhs])/$1i$2/
    - derive/(\w)y([ou][^xhs])/$1j$2/
    - derive/(\w)w([ou][^xhs])/$1x$2/

    - derive/(\w)v(iəv)/$1$2/ #合口之
    - derive/(\w)(viə)v/$1$2/ #合口之

    - derive/(\w)e([aeiouə])/$1$2/ #一四等
    - erase/(\weo[xhs])/$1/ #一四等
    # - derive/(\w)v([o])/$1$2/ #一四等 o
    - derive/(\w)r([aeiouə])/$1a$2/ #二等
    - derive/(\w)l([aeiouə])/$1o$2/ #二等

    - derive/ə/eo/ #EOə eo
    - derive/ə/;/ #EOə eo



    # - derive/([jxaeiouə])\1(\w)/$1$2/ jx #省
    - derive/Jj/j/
    - derive/(X)[uw]/x/
    # - derive/(^|')(x)w(\w)/$1$2/ 
    - abbrev/(\w)ə/$1/  #省ə
    - abbrev/^([a-z]).+$/$1/ #首字母
    - abbrev/(\w)[ijx](\w)/$1i$2/ #i=jxi
    - abbrev/(\w)[uyw](\w)/$1u$2/ #i=jxi
    - abbrev/(\w)[aəo]([ndztmbfp])/$1e$2/ #aə→e
translator:
  dictionary: phuagthucdsis
  spelling_hints: 8
  prism: phuagthucdsis
  preedit_format:
    # - xform/(^|[' ])eo/$1ə/
    - xform/;/ə/
    # - xform/(^|[' ])([ptk])h(\w)/$1$2ʰ$3/
    # - xform/(^|[' ])ng(\w)/$1ŋ$2/
    # - xform/([aeiouə])h($|[' ])/$1ʔ$2/
#     # - xform/(^|[' ])r/$1tʰ/
#     # - xform/(^|[' ])f/$1pʰ/
#     # - xform/(^|[' ])y/$1kʰ/
#     # - xform/(^|[' ])v/$1cʰ/
#     # - xform/(^|[' ])w/$1ŋ/

gepxuuz:
  dictionary: phuagthucdsis
  overwrite_comment: false
  tag: [pinyin,zyenpheng]
  preedit_format:

pinyin:
  dictionary: luna_pinyin
  prefix: "i"
  # suffix: ";"
  tips: 〔pinyin〕
  tag: pinyin
  # closing_tips:
  # # contextual_suggestions: #優化
 
zyenpheng:
  dictionary: zyenpheng
  prefix: "a"
  suffix: ";"
  tips: 〔zyenpheng〕
  # contextual_suggestions: #優化
  tag: zyenpheng


unicode:
  dictionary: unicode
  tag: unicode
  prefix: "u"
  # suffix: ";"
  tips: 〔unicode〕

punctuator:
  import_preset: symbols

  half_shape:
  
    "`": ["`", "·"]
    "~": ["~", "~"]
    "!": [ "!","！"]
    "@": ["@", "＠", "☯"]
    "#": ["#", "＃", "⌘"]
    "$": ["$", "￥", "€", "£", "¥", "¢", "¤"]
    "%": ["%", "％", "°", "℃"]
    "^": ["^", "……", "↑"]
    "&": ["&", "∩","∧", "＆"]
    "*": ["*", "×", "∙", "∏", "∐", "∘", "・", "⊙", "※", "❂", "＊"]
    "(": ["(", "（"]
    ")": [")", "）"]
    "-": ["-", "−", "∖", "－"]
    "_": ["_", "——"]
    "=": ["=", "＝"]
    "+": ["+", "∫", "∑", "⨋", "＋"]
    "[": ["[", "「", "【", "〔", "［" ]
    "]": ["]", "」", "】", "〕", "］"]
    "{": ["{", "『", "〖", "｛"]
    "}": ["}", "』", "〗", "｝"]
    ":": [":", "："]
    ";": [";", "；"]

    "|": ["|", "∪"," ∨", "¦", "§", "｜"]
    "\\": ["\\", "、", "＼"]
    "\'": ["\'", "‘", "’"] # ' 
    "\"": ["\"", "“”"] # '"
    "<": ["<", "《", "〈", "«", "‹", "←", "∈", "⊆", "⊊", "⊈"]
    ">": [">", "》", "〉", "»", "›", "→", "∋", "⊇", "⊋", "⊉"]
    ",": ["," ,  "，"]
    ".": ["." ,  "。"]
    "?": ["?" ,"∞" , "？"]
    "/": ["/", "∕"  , "\\",  "、", "÷", "／"]
    
  full_shape:
    "(": ["(", "（"]
    ")": [")", "）"]
    "<": ["《", "〈", "«", "‹", "←"]
    ">": ["》", "〉", "»", "›", "→"]
key_binder:
  import_preset: default
  bindings:
    - {accept: 0, send: KP_0, when: has_menu}
    - {accept: 1, send: KP_1, when: has_menu}
    - {accept: 2, send: KP_2, when: has_menu}
    - {accept: 3, send: KP_3, when: has_menu}
    - {accept: 4, send: KP_4, when: has_menu}
    - {accept: 5, send: KP_5, when: has_menu}
    - {accept: 6, send: KP_6, when: has_menu}
    - {accept: 7, send: KP_7, when: has_menu}
    - {accept: 8, send: KP_8, when: has_menu}
    - {accept: 9, send: KP_9, when: has_menu}
    - {accept: KP_0, send: 0, when: always}
    - {accept: KP_1, send: 1, when: always}
    - {accept: KP_2, send: 2, when: always}
    - {accept: KP_3, send: 3, when: always}
    - {accept: KP_4, send: 4, when: always}
    - {accept: KP_5, send: 5, when: always}
    - {accept: KP_6, send: 6, when: always}
    - {accept: KP_7, send: 7, when: always}
    - {accept: KP_8, send: 8, when: always}
    - {accept: KP_9, send: 9, when: always}

ascii_composer:
    good_old_caps_lock: true
    switch_key: {Caps_Lock: noop, Control_L: noop, Control_R: noop, Eisu_toggle: clear, Shift_L: commit_code, Shift_R: commit_code}

recognizer:
  import_preset: default
  patterns:
    pinyin: "^i[a-z]*'?$"
    email: "^[a-z][-_.0-9a-z]*@.*$"
    punct: "/[a-z]*$" #配合symbols.yaml中的特殊字符輸入
    unicode: "^u[0-9abcde]*;?$"
    zyenpheng: "^a[a-z]*;?$"
