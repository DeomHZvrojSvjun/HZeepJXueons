# Rime schema
# encoding: utf-8

schema:
  schema_id: hzeepquuns
  name: 叶韻
  version: "2022.02.7"
  author:
    - 
  description: |
    基于中古音系，參攷上古擬音
    韻典網·廣韻 http://ytenx.org/kyonh/
    切韻小鏡 廣韻集韻 http://www.kaom.net/zgy_dw.php
    廣韵形聲攷 https://zhuanlan.zhihu.com/p/493675890
  dependencies:
    - luna_quanpin
    - cangjie6
switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 㢴文 ]
  - name: full_shape
    reset: 0
    states: [ 半寬, 全寬 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    reset: 1
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@pinyin
    - affix_segmentor@cangjie6_lookup
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - script_translator
    - script_translator@pinyin
    - script_translator@quanpin
    - table_translator@cangjie6
    - table_translator@cangjie6_lookup
  filters:
    - simplifier
    - uniquifier
    # - cjk_minifier
    - reverse_lookup_filter@lookup

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcbaABCDEFGHIJKLMNOPQRSTUVWXYZ;'
  delimiter: "'"
  algebra:
####
    - derive/-//
    - derive/_//
    - derive/ʌ/oe/
    - derive/ə/eo/
    - derive/\w-//
    # - derive/\w_//
####韻
##補
    # - derive/([\w])vio([qhsA])/$1ua$2/ #ua uo魚
    # - derive/([\w]v?)o([qhsA])/$1ia$2/
    - derive/[o]ov([qAs])$/əu$1/ #ov 侯
    - derive/[jrxi]ov([qAs])$/eu$1/ #ov 幽 eu=eiu
    - derive/[jrxi]əv([qAs])$/iu$1/ #ov 尤

    # - derive/([\w])vi([ouə])/$1u$2/ #uə
    # - derive/([\w])vx([uə])/$1w$2/ #
    # - derive/([\w])v([o])/$1$2/

    - fuzz/([\w]v)ə([jlrndztCgxk][qAs]?)$/$1o$2/

##韻-介
    # - derive/v(o[jlrndzt])/$1/ #von voj
    - fuzz/v[ou]([jlrndzt])/o$1/ #vun
##韻-尾 (-)

    # - derive/([eov]a)j/$1/ #aj vuj  vu va
    # - derive/([rxw]a)j/$1/ #aj iaj
    # - derive/([eoviujyrxwaf]u)j/$1/
    # - derive/([eovjyrxwaf]i)j/$1/ #ij

    - fuzz/([o]ʌ)j/$1/ #ʌ-j
    - fuzz/([ev]e)j/$1/ #e-j

    - fuzz/(.i)C/$1n/ #iŋ
    - fuzz/(.i)g/$1d/ #iŋ
    - fuzz/(.i)x/$1z/ #iŋ
####介
##三等二分
    # - xform/(.)i(ə|ʌ|a|e|i|o|u|;)/$1j$2/
    # - xform/(.)u(ə|ʌ|a|e|i|o|u|;)/$1y$2/


    # - fuzz/[jrxI]([aeiouəʌ;])/i$1/ #i=jx
    # - fuzz/[ywU]([aeiouəʌ;])/u$1/
##
    - derive/I/i/
    - derive/U/u/
    - derive/x([aeiou]|ə|ʌ)/r$1/ #r=x

    - derive/o(a|o|ə|ʌ)/$1/ #一等无介音
    - derive/e(ə)/$1/ #e四等 ea
    - derive/(e)(a|e|i|u|ə)/$1/ #e四等 

    - derive/vi([aeiou]|ə|ʌ|;)/u$1/ #uə
    - derive/v[jrxi]ə/u/ #uə
    - derive/[jrxi](ə|ʌ)/i/ #i
    - derive/[ywu](ə|ʌ)/u/ #i

    - abbrev/[jrx]([aeiouəʌ;])/i$1/ #i=jx
    - abbrev/[yw]([aeiouəʌ;])/u$1/

    - fuzz/[jrxi](i)/i/ #i
    - fuzz/[ywu](i|u)/u/ #u

    - fuzz/[jrxi][uo]/u/ #iu- io-
    - fuzz/(o)(u|o|ʌ)/$1/ #oo ou oʌ 一等
##三等无介音
    # - xform/([\w])[oe]([aeiouəʌ;])/$1o$2/ #一三
    # - xform/([\w])[ij]([aeiouəʌ;])/$1$2/ #一三

    # - xform/([\w])[rx]([aeiouəʌ;])/$1r$2/

####韻-尾 (+)

    - derive/(u)v/$1/ #uv
    - derive/(ao)v/$1/ #ov

####聲
##古
    - derive/^ss/S/
    - derive/^z[sz]/Z/

    - derive/^[nL]sc/sc/
    - derive/^[nL]zc/zc/

    - derive/^([LR])(?!zc)/d/
    - derive/^([LRn]sh)/th/
    - derive/^(C)(?=[cR])/n/

    - derive/^(h[mnCLRqXx]s|hsq|ngs|[mnCqX]s|hs)/h/
    - derive/^(hqz|Xqz|Xq|qz|Xz|X)/q/ #无別
    - derive/^(hg)/g/

####聲-介
    - derive/^(tSh?|d?Z|S|th?R|dR|nR)i([aeiouəʌ])/$1x$2/
    - derive/^(tSh?|d?Z|S|th?R|dR|nR)u([aeiouəʌ])/$1w$2/
    - derive/^([Jl]|t?sc?h?|d?zc?|nc)i([aeiouəʌ])/$1j$2/
    - derive/^([Jl]|t?sc?h?|d?zc?|nc)u([aeiouəʌ])/$1y$2/
    - derive/^([Jl]|t?s?c?h?|d?z?c?|nc|tSh?|d?Z|S|th?R|dR|nR)[ijrx]([aeiouəʌ])/$1i$2/ #i=jx 在Jj前
    - derive/^([Jl]|t?s?c?h?|d?z?c?|nc|tSh?|d?Z|S|th?R|dR|nR)[uyw]([aeiouəʌ])/$1u$2/
##古?
    - derive/^(Jqz?|JL|J)/j/ #l
    - derive/^(Lc)/j/
####中
    - derive/^([pbm])F/$1/

    - derive/^(kh|k|g|C)[cq]/$1/
    - derive/^(th|t|d|n)[cR]/$1/

    - derive/^(t?)S/$1s/ #tsz sz
    - derive/^(d?)Z/$1z/
    - derive/^(hz|E)/g/
    - derive/^(tsch)/th/
    - derive/^(tsc)/t/
    - derive/^(dzc)/d/
##古𧜰
    - derive/^(s[ptkLRnmCq])s/$1/
    - derive/^z[ptkLRnmCq][sz]/$1/
    # - derive/^s([ptkbdgnmCqL])c/sc/ #L不c
    # - derive/^z([ptkbdgnmCqL])c/zc/

    - derive/^((kh|k|g|C)L)[cq]/$1/
    - derive/^(c[pbm])F/$1/
##聲母轉寫
    # - derive/^(hqz|hg|hz)/E/
    # - derive/^(hq)/A/
    - derive/^(A)/hq/ #影母
    - derive/^(E)/hz/ #匣母
    - derive/^(C)/ng/ #疑母
    - derive/^(th?|d)(R)/$1rr/ #來母
    - derive/^(t?)(S)/$1ss/ #生母
    - derive/^(d?)(Z)/$1zs/ #俟母
    # - derive/^(L)(?!s)/lz/ L
    # - derive/^(Lsh)/ls/
    # - derive/^(R)(?!s)/rz/ R
    # - derive/^(Rsh)/rs/
    # - derive/^(kh|hg|k|g|h|C|A)L/$1ll/ #hgL VL AL?
    # - derive/^([\w]*)-([pbm])F/$1$2ff/
    - derive/^cmF?/cm/
####聲補
    # - derive/^([tk]hc|thR|ts[szc]h)/tzh/ #照組tsz sz. tss ss
    # - derive/^([tk]c|tR|ts[szc])/tz/
    # - derive/^([dg]c|dR|dz[szc])/ds/
    # - derive/^(s[szc])/sz/
    # - derive/^(z[szc])/zz/
    - fuzz/^z/zz/ #衺

    - derive/^(Lr?)([eovarfrxw][aeiouəʌ;])/j$2/
    - derive/^(Xq?)([rxw][aeiouəʌ;])/j$2/
    - derive/^(hzq?|hqz|Xqz?|Xz|qz|E)([eovaf][aeiouəʌ;])/q$2/ #雲一
    - derive/^(Jq)([jy][aeiouəʌ;])/q$2/ #雲三A

    - derive/^(tshc|tsch)([jy])/kh$2/
    - derive/^(tsc)([jy])/k$2/
    - derive/^(dzc)([jy])/g$2/
####聲-介
    - derive/^(j)[j]([aeiouəʌ;])/$1$2/ #㠯母
    - derive/^(q)u([aeiouəʌ;])/$1$2/ #雲母

    - derive/^(hms)v([ʌəo])/$1$2/ #幫組 一三
    - derive/^(hms)v([ʌəo])/h$2/
    - derive/^(ph|p|b|m)v([aeəʌ;])/$1$2/
    - derive/^(ph|p|b|m)v(i[oə])/$1$2/

####尾
    # - derive/(?<!^)A$/hq/ 轉寫
    # - derive/(?<!^)C([sAq])$/ng$1/
    - derive/(?<!^)R([sAq])$/rr$1/
    # - derive/(?<!^)F/ff/

    - fuzz/([aeiouəʌ;])j['q]$/$1/
    - derive/([aeiouəʌ;])['q]$/$1/

    - fuzz/(?<!^)([jv])['q]$/$1/ #-j-v視爲韻
    # - fuzz/(?<!^)[j]['q]$/j/
    - fuzz/(?<!^)jA$/l/
    - fuzz/(?<!^)js$/r/
    # - fuzz/(?<!^)vq$/v/
    - fuzz/(?<!^)vA$/w/
    - fuzz/(?<!^)vs$/y/
    - fuzz/(?<!^)vks$/y/
    # - fuzz/(?<!^)vs(k)$/y$1/

    # - xform/(vs|[sry])[ptk]$/$1/ # 韻尾-聲調
    - xform/[ptk]-([sr])$/$1/
    - derive/(?<!^)([fvjyxwaeiouəʌ;][aeiouəʌ;])v(k)$/$1u$2/ #-v-視爲韻
    # - xform/(?<!^)v(k)$/$1/
    - fuzz/(?<!^)v(k)$/$1/

    - xform/(?<!^)([Cmn])q$/$1/
    - xform/(?<!^)(ng|C|c)A$/g/
    - xform/(?<!^)(ng|C|c)s$/x/
    - xform/(?<!^)mA$/b/
    - xform/(?<!^)ms$/f/
    - xform/(?<!^)nA$/d/
    - xform/(?<!^)ns$/z/
####
##𥳑尾
    # - derive/(?<!^)q$//
    - derive/(?<!^)A$/h/
    - derive/(?<!^)Cq?$/c/
    - derive/(?<!^)F$/f/
##可選 介 序
    - fuzz/(?<!^)([aiu])(ə|ʌ)/$2$1/
    - fuzz/(?<!^)(i)([au])/$2$1/
    - abbrev/(?<!^)([aiu])([aeiou]|ə|ʌ)/$2$1/ #介元序
    - abbrev/(?<!^)([fvjyrxw])([aeiou]|ə|ʌ)([qAhsjlrvwymbfpndztCcgxk])/$2$1$3/
    - fuzz/(?<!^)x([aeiouəʌ;])/r$1/ #r=x
    - fuzz/(?<!^)r([aeiouəʌ;])/x$1/ #
    - fuzz/(?<!^)a([aeiouəʌ;])/l$1/ #l=a
    - abbrev/(?<!^)([rl])([aeiou]|ə|ʌ)([qAhsjlrvwymbfpndztCcgxk])/$2$1$3/ #l=x
    # - fuzz/(?<!^)(a)([aeiouəʌ;])/$2l/ #qAhsjlrvwymbfpndztCcgxk
    # - fuzz/(?<!^)(x)([aeiouəʌ;])([.])/$2r$3/

##聲𥳑
    - derive/^sc/h/ #船
    - derive/^zc(?=[jy])/q/ #書
    - derive/^dz(?!c)/z/

    - derive/^ph/f/
    - derive/^th/r/
    - derive/^kh/y/
    - derive/^ts(s?)h/v$1/
    - derive/^ts(?!c)/x/
    - derive/^(hq|A)/w/
    - derive/^(ng|C)/c/

##𥳑 首字母
    # - abbrev/^(\w).+$/$1/
    # - abbrev/^(\w[zhcqs]?[lrfvjyxw]).+$/$1/ #介
    # - abbrev/^(tsh?|dz).+$/$1/
    # - abbrev/^([ptkw]h).+$/$1/
    # - abbrev/^(sz).+$/$1/
    # - abbrev/^([sz]c).+$/$1/
    # - abbrev/^(hz|hq).+$/$1/
    # - abbrev/^(ng).+$/$1/

    # - erase/^[a-z][zhcgqs].+$/
    # - abbrev/^([a-z])[^szhcgqrl].*$/$1/ #𥳑

    - abbrev/^([a-zA-Z])[aeiouvfjyxwə].*$/$1/ #𥳑
####轉寫
    - derive/-//
    - derive/_//
    - derive/(ʌ|ə)/;/ #ə eo 需緟𧜰
    - derive/ʌ/oe/
    - derive/ə/eo/
    - derive/(ʌ|ə)/ea/
    # - derive/A/hq/
    # - derive/C/ng/
    # - derive/E/hz/
    # - derive/R/rr/
    # - derive/S/ss/
    # - derive/Z/zs/
    # - derive/F/ff/ #pF
    # - derive/L/ll/ #k-L

translator:
  dictionary: hzeepquuns
  prism: hzeepquuns
  spelling_hints: 10
  enable_completion: false
  preedit_format:
    - xform/;/ə/
    - xform/(^|')r/$1tʰ/
    - xform/(^|')f/$1pʰ/
    - xform/(^|')v/$1t͡sʰ/
    - xform/(^|')y/$1kʰ/
    - xform/(^|')x/$1t͡s/
    - xform/(^|')c([jyxrwaeiou]|ə|ʌ|$|')/$1ŋ$2/
    - xform/(^|')w/$1ʔ/
    # - xform/eo/ə/
    # - xform/ea/ʌ/
    # - xform/hq/ʔ/
    # - xform/ng/ŋ/
    # - xform/hz/ɦ/
    - xform/([aeiouəʌ;])h($|')/$1ʔ$2/
    - xform/([aeiouəʌ;])c($|')/$1ŋ$2/
    # - xform/([aeiouəʌ;])g($|')/$1ŋʔ$2/
    # - xform/([aeiouəʌ;])x($|')/$1ŋs$2/
    # - xform/([aeiouəʌ;])b($|')/$1mʔ$2/
    # - xform/([aeiouəʌ;])f($|')/$1ms$2/
    # - xform/([aeiouəʌ;])d($|')/$1nʔ$2/
    # - xform/([aeiouəʌ;])z($|')/$1ns$2/
    # - xform/([aeiouəʌ;])w($|')/$1vʔ$2/
    # - xform/([aeiouəʌ;])y($|')/$1vs$2/
    # - xform/([aeiouəʌ;])l($|')/$1jʔ$2/
    # # - xform/([aeiouəʌ;])r($|')/$1js$2/

    # - xform/hg/ʁ/
    # - xform/xz/ɣ/
    # - xform/xzq/ʁ/
    # - xform/xsq/ʁ/
    # - xform/ngq/ɴ/
    # - xform/qz/ɢ/
    # - xform/A/ʔ/
    # - xform/E/ɦ/
    # - xform/nR/ɳ/
    # - xform/S/ʃ/
    # - xform/Z/ʒ/
    # - xform/sc/ɕ/
    # - xform/zc/ʑ/
    # - xform/sR/ʂ/
    # - xform/zR/ʐ/
    # - xform/tsc/t͡ɕ/
    # - xform/dzc/d͡ʑ/
    # - xform/tS/t͡ʃ/
    # - xform/dZ/d͡ʒ/
    # - xform/tsR/t͡ʂ/
    # - xform/dzR/d͡ʐ/
    # - xform/pF/p͡ɸ/
    # - xform/bF/B͡β/
    # - xform/nF/ɱ/
    # - xform/tR/ʈ/
    # - xform/dR/ɖ/
    # - xform/([A-Z])O/$1ˤ/
    # - xform/([A-Z])V/$1ʷ/
    # - xform/(.+)H/\L$1ʰ/
    # - xform/([aeiouəʌ;])q($|')/$1 $2/
  comment_format:
    # - xform/[\w]-//
    - xform/-//
    - xform/_//
    - xform/([IU])/\L$1/
    # - xform/^s[ptkLRnmCq]s?/s/
    # - xform/^z[ptkLRnmCq]s?/z/
    # - xform/^s(ns?|Ls?|Cs?|[ptkbdgnmCq])c/sc/
    # - xform/^[nL]sc/sc/
    # - xform/^z(ns?|Ls?|Cs?|[ptkbdgnmCq])c/zc/
    # - xform/^[nL]zc/zc/
    - xform/A/ʔ/
    - xform/E/ɦ/
    - xform/S/ʃ/
    - xform/Z/ʒ/
    - xform/sR/ʂ/
    - xform/zR/ʐ/
    - xform/tR/ʈ/
    - xform/dR/ɖ/
    # - xform/^(hms|hns|hCs|hqs|hLs|hxs|hsq|ngs|Cs|ms|qs|Xs|hs)/h/
    - xform/^Xs/h/
    # - xform/^([LRn]sh)/th/
    # - xform/^(L|Rz)/d/
    - xform/^JL/J/
    - xform/^(hqz|Xqz|JXq?|xz|qz|Xz|X)/q/
    - xform/C/ŋ/
    # - xform/([rs])[ptk]($|')/$1/
  initial_quality: 0.7

quanpin:
  dictionary: luna_pinyin
  prism: luna_quanpin
  enable_completion: false
  prefix: ""
  # suffix: "'"
  tips: 〔quanpin〕
  tag: quanpin
  # closing_tips:
  # # contextual_suggestions: 
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue('|$)/$1üe$2/
    - xform/([jqxy])v/$1ü/
  initial_quality: 0.5

pinyin:
  dictionary: luna_pinyin
  prism: luna_pinyin
  prefix: "~"
  suffix: "'"
  tips: 〔pinyin〕
  tag: pinyin
  # closing_tips:
  # # contextual_suggestions: 
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue('|$)/$1üe$2/
    - xform/([jqxy])v/$1ü/

cangjie6:
  dictionary: cangjie6
  prism: cangjie6
  enable_charset_filter: false
  enable_sentence: false
  enable_encoder: false
  encode_commit_history: false
  enable_completion: false
  enable_user_dict: false
  prefix: ""
  tips: 〔倉頡6〕
  tag: cangjie6
  # closing_tips:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|
  comment_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片～|"
  initial_quality: 0.6

cangjie6_lookup:
  dictionary: cangjie6
  prism: cangjie6
  enable_charset_filter: false
  prefix: "`"
  suffix: "'"
  tips: 〔倉頡6〕
  tag: cangjie6_lookup
  # closing_tips:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|
  comment_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片～|"

abc_segmentor: #混用
  extra_tags: [quanpin]

lookup:
  tags: [pinyin,cangjie6_lookup]
  dictionary: hzeepquuns
  overwrite_comment: false
  comment_format:

punctuator:
  import_preset: symbols
key_binder:
  import_preset: default
  bindings:
ascii_composer:
    good_old_caps_lock: true
    switch_key: {Caps_Lock: noop, Control_L: noop, Control_R: noop, Eisu_toggle: clear, Shift_L: commit_code, Shift_R: commit_code}

recognizer:
  import_preset: default
  patterns:
    email: "^[a-z][-_.0-9a-z]*@.*$"
    # punct: '^/([0-9]0?|[A-Za-z]+)$' #配合symbols.yaml中的特殊字符輸入
    punct: "^/[0-9a-zA-Z]*$" #配合symbols.yaml中的特殊字符輸入
    pinyin: "^~[a-z]*'?$"
    cangjie6_lookup: "^`[a-z]*'?$"
