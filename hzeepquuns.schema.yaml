# Rime schema
# encoding: utf-8

schema:
  schema_id: hzeepquuns
  name: 叶韻
  version: "2022.02.7"
  author:
    - 
  description: |
    基于中古音系，參攷上古擬音
    仿羅馬通字方案 https://zhuanlan.zhihu.com/p/388867479
    韻典網·廣韻 http://ytenx.org/kyonh/
    切韻小鏡 廣韻集韻 http://www.kaom.net/zgy_dw.php
    广韵形声考 https://zhuanlan.zhihu.com/p/493675890
  dependencies:
    - luna_pinyin
    - cangjie6
switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 㢴文 ]
  - name: full_shape
    reset: 0
    states: [ 半長, 全長 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    reset: 1
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@pinyin
    - affix_segmentor@cangjie6
    - punct_segmentor
    - fallback_segmentor
  translators:
    # - echo_translator
    - punct_translator
    - script_translator
    - script_translator@pinyin
    - table_translator@cangjie6
    # - encode_commit_history
  filters:
    - simplifier
    - uniquifier
    # - cjk_minifier
    - reverse_lookup_filter@lookp

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcbaABCDEFGHIJKLMNOPQRSTUVWXYZ;'
  delimiter: "'"
  algebra:
# ####聲
    # - derive/(^|')(PHF)/ph/
    # - derive/(^|')(PF)/p/
    # - derive/(^|')(BF)/b/
    # - derive/(^|')(MF)/m/

    # # - derive/(^|')(TSCH|TSHC|TH[RC]?)/th/
    # # - derive/(^|')(TSC|T[RC]?)/t/
    # # - derive/(^|')(DZC|D[RC]?)/d/
    # # - derive/(^|')(N[CR]?)/n/

    # - derive/(^|')(SZ|ZS|ZZ)/sz/
    # # - derive/(^|')SS?/s/
    # - derive/(^|')(TSS|TSR|T[SZ])/ts/
    # - derive/(^|')(DZS|DZR|D[ZS])/dz/
    # - derive/(^|')(TSSH|TSHS|T[SZ]H)/tsh/

    # # - derive/(^|')(KH[CQ]?)/kh/
    # # - derive/(^|')(K[CQ]?)/k/
    # - derive/(^|')(HZG?|HG|GC?)/g/
    # # - derive/(^|')(H)/h/
    # - derive/(^|')(HXS|HSQ|HQS|NGS|MS|[XH]S|SX|QS)/h/
    # - derive/(^|')(HZQ|HG|HZ)/hz/

    # - derive/(^|')(HQ|A)/hq/
    # - derive/(^|')(JXQ?|XQZ|QZ|XZ|X|')/q/
    # - derive/(^|')(NGQ?)/c/
    # # - derive/(^|')hz/E/
    # # - derive/(^|')hq/A/

    # - derive/(^|')(JQZ?|J)/j/ #l
    # # - derive/(^|')L/l/
    # # - derive/(^|')SC/sc/
    # # - derive/(^|')ZC/zc/

    # - derive/(^|')(LZ[RC]?)/d/
    # - derive/(^|')([LRN]S[RC]?)/th/
# ##
    # - derive/(^|')(kh|k|g)[cq]/$2/
    # - derive/(^|')(th|t|d|n)[cr]/$2/
    # - derive/(^|')(tsch)/th/
    # - derive/(^|')(tsc)/t/
    # - derive/(^|')(dzch)/d/
    # - derive/(^|')(ts|dz)[s]/$2/
    # - derive/(^|')([sz])[s]/$2/
    # - derive/(^|')h[gz]/g/
# ####可選
# ##

    # # - derive/(^|')([tk]h[rc]|ts[sc]h)/tsrh/ #照組
    # # - derive/(^|')([tk][rc]|ts[sc])/tsr/
    # # - derive/(^|')([dg][rc])/dzr$1/
    # # - derive/(^|')(s[sc])/sr/
    # # - derive/(^|')(z[sc])/zr/
# ##介

    # - abbrev/([\w])a(ə|a|e|i|o|u)/$1r$2/ #r=a
    # - abbrev/([\w])x(ə|a|e|i|o|u)/$1l$2/ #l=x
    # # - derive/([\w])i(ə|a|e|i|o|u)/$1j$2/
    # # - derive/([\w])u(ə|a|e|i|o|u)/$1y$2/
    # - derive/([\w])v(o[jlrndzt])/$1$2/ #von vo 
# ##韻
    # # - derive/([\w])vio([qhsA])/$1ua$2/ #ua uo
    # # - derive/([\w][ijx])o([qhsA])/$1a$2/
    # # - derive/([\w])[ijx]u([cgxk])/$1u$2/ #iu- io-
    # # - derive/([\w])[ijx]o([cgxk])/$1u$2/
    # # - derive/([\w])[uyw]o([qhsA])/$1u$2/ #iu- uo-
    # # - derive/([\w])[ijx]u([qhsA])/$1u$2/
    # # - derive/([\w])[ijx]o([mbfp])/$1u$2/
    # # - derive/([\w])[ijx]u([mbfp])/$1u$2/
    # # - derive/([\w])[jxi]o([vwy])$/$1i$2/ #尤幽侯iv
# ##
    # - derive/([\w])v(k)$/$1$2/
# ####韻-尾

    # - derive/([\w][eovjxywarf]i)c/$1n/  #iŋ必
    # - derive/([\w][eovjxywarf]i)g/$1d/
    # - derive/([\w][eovjxywarf]i)x/$1z/

    # - derive/([\w][eov]a)j/$1/ #aj vuj  vu va
    # - derive/([\w][eov]u)j/$1/
    # - derive/([\w][xw]a)j/$1/ #aj iaj
    # # - derive/([\w][yw]o)j$/$1/ #uoj
    # - derive/([\w][eovjyxwarf]i)j/$1/ #ij
    # - derive/([\w])([oe]u)v([qhsA])/$1$2$3/ #皋勹ov rov
    # - derive/([\w])([ar]u)v([qhsA])/$1$2$3/
    # # - derive/([\w]u[uo])v([qhsA])$/$1$2/ #uuv 孚
    # - derive/([\w])oəu([qhsA])/$1ov$2/ #ov 侯
    # - derive/([\w])oəu([qhsA])/$1e$2/ #eu侯

    # - derive/([\w][jxi])(əv|iv|u)['q]$/$1ov/ #尤侯iov jov
    # - derive/([\w][jxi])(əv|iv|u)[hA]$/$1ow/ #
    # - derive/([\w][jxi])(əv|iv|u)s$/$1oy/ #
    # # - derive/([\w][jx])iəu([qhsA])/$1ov$2/ #幽侯
    # - derive/([\w][jx])iə([vwy])$/$1ov$2/
# ####介
# ##
    # - derive/([\w])o([ao]|ə|ʌ)/$1$2/ #一等无介音
    # - derive/([\w])e(ə)/$1$2/ #e四等 
    # - derive/([\w])(e)(e|i|ə)/$1$2/ #e四等 

    # - derive/([\w])vi([aeiouəʌ])/$1u$2/ #uə
    # - derive/([\w])vx([aeiouəʌ])/$1w$2/ #

    # - abbrev/(\w)[jx]([aeiouə])/$1i$2/ #i=jxi
    # - abbrev/(\w)[yw]([aeiouə])/$1u$2/ #i=jxi

    # - derive/(\w)[jxi](i|ə)/$1i/ #i
    # - derive/(\w)[ywu](i|u|ə)/$1u/ #u
# ##三等无介音
    # # - xform/([\w])[oe]([aeiouəʌ])/$1o$2/ #一三
    # # - xform/([\w])[ij]([aeiouə])/$1$2/ #一三

    # # - xform/([\w])x([aeiouə])/$1r$2/

# ####
    # - derive/(^|')(LZ[RC]?)([eovarfxw][aeiouəʌ])/j$3/
    # - derive/(^|')(JX)([xw][aeiouəʌ])/j$3/
    # - derive/(^|')(HZQ?|XQZ?|XZ|QZ)([eovarf][aeiouəʌ])/q$3/
    # - derive/(^|')(JQZ?)([jy][aeiouəʌ])/q$3/

    # - derive/(^|')(TSC)([jy])/k$3/
    # - derive/(^|')(TSCH)([jy])/kh$3/
    # - derive/(^|')(DZC)([jy])/g$3/

    # - derive/(^|')(hzq?)([eovarf][aeiouəʌ])/q$3/
    # - derive/(^|')(tsc)([jy])/k$3/
    # - derive/(^|')(tsch)([jy])/kh$3/
    # - derive/(^|')(dzc)([jy])/g$3/
    # - derive/(^|')(jq)([jy][aeiouəʌ])/j$3/
    # - derive/(^|')(jq)([jy][aeiouəʌ])/q$3/
# ####聲-介
    # - derive/(^|')(JQZ|JQ|J)j(?!$)/j/ #㠯母
    # - derive/(^|')(JXQ?|XQZ|QZ|X)u([aeiouə])/$1q$3/ #雲母
    # - derive/(^|')(JQZ|XQZ|QZ|XQ|JX|JQ|X)v(i[əaeoi])/$1q$3/
    # - derive/(^|')(L)r/l/
    # - derive/(^|')MSv([ʌəo])/h$2/ #幫組 一三
    # - derive/(^|')(PH|P|B|M)F?v([aʌəei])/\L$2$3/


    # - derive/(^|')(q)u([aeiouə])/q$3/ #雲母
    # - derive/(^|')(q)v(i[əaeoi])/q$3/
    # - derive/(^|')(l)r/l/
    # - derive/(^|')(ph|p|b|m)v([aʌəei])/$2$3/

####尾
    # - derive/(\w)h$/$1A/
    - derive/(\w)A$/$1h/
    - xform/(vs|[sry])[ptk]$/$1/ # 韻尾-聲調
    # - derive/(\w)v(k)$/$1$2/
    - derive/(\w)['q]$/$1/
    # - derive/(\w)jh$/$1/ #-j
    # - derive/(\w)js$/$1r/
    - abbrev/(\w)j['q]$/$j/ #-j
    - abbrev/(\w)jA$/$1l/
    - abbrev/(\w)js$/$1r/
    - derive/(\w)vA$/$1w/
    - derive/(\w)vs(k)/$1y$2/
    - derive/(\w)vsk?/$1y/

####
    - derive/ʌ/ea/ #EOə eo
    - derive/ə/eo/ #EOə eo
    - derive/(eo|oe|ea)/;/ #EOə eo

###########
# 鈍音 ([PTK]H?|[BDG]|F([PB]|PH)|H[SZGQ]|[SZ]X|XQ|JX|[M]F?|NG)
# 銳音 ([TDNSZKG][C]|[TDN][R]|[TDSNLJ]|TH|[TK]H[CR]||SZ|[TD][SZ]H?|[SZ]S|[SZ]Z)
# 銳音 (([TK]H?|[NSZDG][C])|([T]H?|[DN][R])|([TDSNLJ]|SZ|TH)|([T][SZ]H?|[D][SZ])|[SZ]S|[SZ]Z)



####

    - derive/^sc/h/ #船
    - derive/^zc/q/ #書

    - derive/^ph/f/
    - derive/^th/r/
    - derive/^kh/y/
    - derive/^tsh/v/
    - derive/^hq/x/
    - derive/^ts/w/
    - derive/^dz/z/
    - derive/^(sz)/z/ #邪

    - derive/^dzr/z/  #照
    - derive/^tsr/w/
####
    - abbrev/^([\w][zhcqs]?)([rlfvjyxw])([aeiouəʌ])([\w' ])$/$1$3$2$4/ #介元序
    - abbrev/^([\w][zhcqs]?)([aeiu])([aeiouəʌ])([\w' ])$/$1$3$2$4/ #介元序 无o
####
    # - erase/^[a-z][zhcgqs].+$/聲母一鍵 

    - abbrev/^(\w)[^zhcqs].*$/$1/ #𥳑
    - abbrev/^(\w[zhcqs]?[lrfvjyxw]).*$/$1/ #介
    # - abbrev/^(tsh?|dz).+$/$1/
    # - abbrev/^([ptkw]h).+$/$1/
    # - abbrev/^(sz).+$/$1/
    # - abbrev/^([sz]c).+$/$1/
    # - abbrev/^(hz|hq).+$/$1/

    # - abbrev/^(ng).+$/$1/

# # # # # # # 
    # - derive/(^|')([A-Zbcdfghjklmnpqrstvwxyz]+)(?!$)/I/ #聲
    # - derive/(^|')(F?(PH?|B)|MF?)(?!$)/PI/
    # - derive/(^|')(ph|p|b|m)(?!$)/PI/
    # - derive/(^|')(TSSH?|DZZ|T[CR]?H?|D[CR]?|N[RC]?)(?!$)/TI/
    # - derive/(^|')((th|t|d|n)[rc]?)(?!$)/TI/
    # - derive/(^|')(T[SZ]H?|D[SZ])(?!$)/TSI/
    # - derive/(^|')((ts|dz)[sc]?h?)(?!$)/TSI/
    # - derive/(^|')(NGQ?|HG|HQ|K[CQ]?H?|G[C]?|L|X?QZ|XZ|HQ|A)(?!$)/KI/
    # - derive/(^|')((kh|k|g)(qc)?)(?!$)/KI/
    # - derive/(^|')(X[SZ]|HZ|XQ|HQ|H)(?!$)/HI/
    # - derive/(^|')(h)(?!$)/HI/
    # - derive/(^|')(JX?)(?!$)/JI/
    # - derive/(^|')(j)(?!$)/JI/
    # - derive/(^|')(S[SZ]|ZS|ZZ|S)(?!$)/SI/
    # - derive/(^|')(SC|XS)(?!$)/SI/
    # - derive/(^|')(s[sc]?)(?!$)/SI/
    # - derive/(^|')(ZC|XZ)(?!$)/ZI/
    # - derive/(^|')(sz|z[sc]?)(?!$)/ZI/
    # - derive/(^|')(SZ|ZS|[SZ]C|L[SZ][RC]?|J)(?!$)/LI/
    # - derive/(^|')(RS[RC]?|L)(?!$)/RI/
    # - derive/(^|')(l)(?!$)/RI/
    # - derive/(^|')(X[SZ]|MS|M)(?!$)/MI/
    # - derive/(^|')(m)(?!$)/MI/
    # - derive/(^|')(N[CR]?|[ZC]C|NS[RC]?)(?!$)/NI/
    # - derive/(^|')(n[rc]?)(?!$)/NI/
    # - derive/(^|')(NGQ?|X[SZ])(?!$)/NGI/


translator:
  dictionary: hzeepquuns
  prism: hzeepquuns
  spelling_hints: 10
  preedit_format:
    - xform/;/ə/
    # - xform/(^|')r/$1th/
    # - xform/(^|')f/$1ph/
    # - xform/(^|')v/$1tsh/
    # - xform/(^|')y/$1kh/
    # - xform/(^|')w/$1ts/
    # - xform/(^|')c/$1ŋ/
    # - xform/(^|')x/$1ʔ/
    # - xform/ea/ʌ/
    # - xform/hq/ʔ/
    # - xform/ng/ŋ/
    # - xform/hz/ɦ/
    # - xform/([aeiouəʌ])h($|')/$1ʔ$2/
    # - xform/([aeiouəʌ])c($|')/$1ŋ$2/
    # - xform/([aeiouəʌ])g($|')/$1ŋʔ$2/
    # - xform/([aeiouəʌ])x($|')/$1ŋs$2/
    # - xform/([aeiouəʌ])b($|')/$1mʔ$2/
    # - xform/([aeiouəʌ])f($|')/$1ms$2/
    # - xform/([aeiouəʌ])d($|')/$1nʔ$2/
    # - xform/([aeiouəʌ])z($|')/$1ns$2/
    # - xform/([aeiouəʌ])w($|')/$1vʔ$2/
    # - xform/([aeiouəʌ])y($|')/$1vs$2/
    # - xform/([aeiouəʌ])l($|')/$1jʔ$2/
    # # - xform/([aeiouəʌ])r($|')/$1js$2/

    # - xform/HG/ʁ/
    # - xform/XZ/ɣ/
    # - xform/XZQ/ʁ/
    # - xform/XSQ/ʁ/
    # - xform/NGQ/ɴ/
    # - xform/QZ/ɢ/
    # - xform/A/ʔ/
    # - xform/E/ɦ/
    # - xform/NR/ɳ/
    # - xform/SS/ʃ/
    # - xform/SC/ɕ/
    # - xform/ZC/ʑ/
    # - xform/ZS/ʒ/
    # - xform/SR/ʂ/
    # - xform/ZR/ʐ/
    # - xform/TSC/t͡ɕ/
    # - xform/DZC/d͡ʑ/
    # - xform/TSS/t͡ʃ/
    # - xform/DZS/d͡ʒ/
    # - xform/TSR/t͡ʂ/
    # - xform/DZR/d͡ʐ/
    # - xform/PF/p͡ɸ/
    # - xform/BF/B͡β/
    # - xform/MF/ɱ/
    # - xform/TR/ʈ/
    # - xform/DR/ɖ/
    # - xform/([A-Z])O/$1ˤ/
    # - xform/([A-Z])V/$1ʷ/
    # - xform/(.+)H/\L$1ʰ/
    # - xform/([aeiouəʌ])q($|')/$1 $2/
  comment_format:
    - xform/A/ʔ/
    - xform/(HXS|HSQ|HQS|NGS|MS|[XH]S|SX|QS)/h/
    - xform/(LZ)/d/
    - xform/([LRN]S)/th/
    - xform/(XQZ|JXQ?|XZ|QZ|X)/q/
    - xform/NG|c($|')/ŋ$1/
    - xform/F//
    - xform/([A-Z])/\L\1/
    - xform/([rs])[ptk]$/$1/
  initial_quality: 0.7	# 調整該編譯器出字優先度
pinyin:
  dictionary: luna_pinyin
  prefix: "~"
  suffix: "'"
  tips: 〔pinyin〕
  tag: pinyin
  # closing_tips:
  # # contextual_suggestions: 
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue('|$)/$1üe$2/
    - xform/([jqxy])v/$1u/
  initial_quality: 0.5	# 調整該編譯器出字優先度

cangjie6:
  dictionary: cangjie6
  prefix: "`"
  suffix: "'"
  tips: 〔倉頡6〕
  tag: cangjie6
  # closing_tips:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|
  comment_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片～|"
  initial_quality: 0.8


lookp:
  tags: [pinyin,cangjie6]
  dictionary: hzeepquuns
  overwrite_comment: false
  comment_format:
    - xform/A/ʔ/
    - xform/(HXS|HSQ|HQS|NGS|MS|[XH]S|SX|QS)/h/
    - xform/(LZ)/d/
    - xform/([LRN]S)/th/
    - xform/(XQZ|JXQ?|XZ|QZ|X)/q/
    - xform/NG|c($|')/ŋ$1/
    - xform/F//
    - xform/([A-Z])/\L\1/
    - xform/([rs])[ptk]$/$1/
abc_segmentor: #混用
  extra_tags: [pinyin, cangjie6]
punctuator:
  import_preset: symbols
key_binder:
  import_preset: default
  bindings:
ascii_composer:
    good_old_caps_lock: true
    switch_key: {Caps_Lock: noop, Control_L: noop, Control_R: noop, Eisu_toggle: clear, Shift_L: commit_code, Shift_R: commit_code}

recognizer:
  import_preset: default
  patterns:
    email: "^[a-z][-_.0-9a-z]*@.*$"
    # punct: '^/([0-9]0?|[A-Za-z]+)$' #配合symbols.yaml中的特殊字符輸入
    punct: "^/[0-9a-zA-Z]*$" #配合symbols.yaml中的特殊字符輸入
    pinyin: "^~[a-z]*'?$"
    cangjie6: "^`[a-z]*'?$"
