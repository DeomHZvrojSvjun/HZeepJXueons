# Rime schema
# encoding: utf-8

schema:
  schema_id: hzeepquuns
  name: 叶韻
  version: "2022.02.7"
  author:
    - 
  description: |
    基于中古音系，參攷上古擬音
    韻典網·廣韻 http://ytenx.org/kyonh/
    切韻小鏡 廣韻集韻 http://www.kaom.net/zgy_dw.php
    廣韵形聲攷 https://zhuanlan.zhihu.com/p/493675890
  dependencies:
    - luna_quanpin
    - cangjie6
switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 㢴文 ]
  - name: full_shape
    reset: 0
    states: [ 半寬, 全寬 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    reset: 1
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@pinyin
    - affix_segmentor@cangjie6
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - script_translator
    - script_translator@pinyin
    - table_translator@cangjie6
  filters:
    - simplifier
    - uniquifier
    # - cjk_minifier
    - reverse_lookup_filter@lookp

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcbaABCDEFGHIJKLMNOPQRSTUVWXYZ;'
  delimiter: "'"
  algebra:
# # # # # # 
    # - derive/^([A-Zbcdghklmnpqrstz]+)(?!$)/I/ #聲
    # - derive/^(F?(PH?|B)|MF?)(?!$)/pI/
    # - derive/^(ph|p|b|m)(?!$)/pI/
    # - derive/^(TSSH?|DZZ|T[CR]?H?|D[CR]?|N[RC]?)(?!$)/tI/
    # - derive/^((th|t|d|n)[rc]?)(?!$)/tI/
    # - derive/^(T[SZ]H?|D[SZ])(?!$)/tsI/
    # - derive/^((ts|dz)[sc]?h?)(?!$)/tsI/
    # - derive/^(NGQ?|HG|K[CQ]?H?|G[C]?|L|X?QZ|XZ|HQ|A)(?!$)/kI/
    # - derive/^((kh|k|g)(qc)?)(?!$)/kI/
    # - derive/^(X[SZ]|HZ|XQ|HQ|H)(?!$)/hI/
    # - derive/^(h)(?!$)/hI/
    # - derive/^(JX?)(?!$)/jI/
    # - derive/^(j)(?!$)/jI/
    # - derive/^(S[SZ]|ZS|ZZ|S)(?!$)/sI/
    # - derive/^(SC|XS)(?!$)/sI/
    # - derive/^(s[sc]?)(?!$)/sI/
    # - derive/^(ZC|XZ)(?!$)/zI/
    # - derive/^(s?z|z[sc]?)(?!$)/zI/
    # - derive/^(SZ|ZS|[SZ]C|L[SZ][RC]?|J)(?!$)/LI/
    # - derive/^(RS[RC]?|L)(?!$)/RI/
    # - derive/^(l)(?!$)/RI/
    # - derive/^(MS|MF|M)(?!$)/mI/
    # - derive/^(m)(?!$)/mI/
    # - derive/^(N[CR]?|[ZC]C|NS[RC]?)(?!$)/NI/
    # - derive/^(n[rc]?)(?!$)/NI/
    # - derive/^(NGQ?|X[SZ])(?!$)/CI/

# #
    # - derive/(v?[oeviujyxwaf]?)([əʌaeiou])([qAsjlrvwyCgxkmbfpndzt]([ptky]|sk)?)$/U/
    # - derive/(v?[oeviujyxwaf]?)([əʌaeiou])([qAsjlrvwyCgxkmbfpndzt]([ptky]|sk)?)$/$1U/
    # - derive/(v?[oeviujyxwaf]?)([əʌaeiou])([qAsjlrvwyCgxkmbfpndzt]([ptky]|sk)?)$/U$2U/

    # - derive/(v?[oeviujyxwaf]?)([əʌaeiou])([qAsjlrvwyCgxkmbfpndzt]([ptky]|sk)?)$/U$3/
    # - derive/(v?[oeviujyxwaf]?)([əʌaeiou])([qAsjlrvwyCgxkmbfpndzt]([ptky]|sk)?)$/$1$2U/
    # - derive/(v?[oeviujyxwaf]?)([əʌaeiou])([qAsjlrvwyCgxkmbfpndzt]([ptky]|sk)?)$/$1U$3/
    # - derive/(v?[oeviujyxwaf]?)([əʌaeiou])([qAsjlrvwyCgxkmbfpndzt]([ptky]|sk)?)$/U$2$3/
# ##
    # - derive/([qAs])$/qU/
    # - derive/([jlr])$/jU/
    # - derive/([vwy])$/vU/
    # - derive/([Cgxk])$/CU/
    # - derive/([mbfp])$/mU/
    # - derive/([ndzt])$/nU/

    # - derive/([vq]?[qAs])$/QU/
    # - derive/(j[qAs]|[jlr])$/JU/
    # - derive/(j|n)$/RU/
    # - derive/(vsk|yk|vk)$/vkU/
    # - derive/(sk|k|[qAs])$/sU/
    # - derive/(r[tp])$/rU/
    # - derive/(rp|p)$/pU/
    # - derive/(rt|t)$/tU/
    # - derive/(sk|k)$/kU/
####聲
    - derive/^(PFH)/ph/
    - derive/^(PF)/p/
    - derive/^(BF)/b/
    - derive/^(MF)/m/

    # - derive/^(TSCH|TSHC|TH[RC]?)/th/
    # - derive/^(TSC|T[RC]?)/t/
    # - derive/^(DZC|D[RC]?)/d/
    # - derive/^(N[CR]?)/n/

    - derive/^(SZ|ZS|ZZ)/z/
    # - derive/^SS?/s/
    - derive/^(TSSH|TSRH|T[SZ]H)/tsh/
    - derive/^(TSS|TSR|T[SZ])/ts/
    - derive/^(DZS|DZR|D[ZS])/dz/

    # - derive/^(KH[CQ]?)/kh/
    # - derive/^(K[CQ]?)/k/
    - derive/^(HZG|E)/g/
    # - derive/^(H)/h/
    - derive/^(HXS|HSQ|HQS|NGS|CS|MS|[XH]S|SX|QS)/h/
    - derive/^(HQZ|XQZ|JXQ?|QZ|XZ|X|')/q/

    # - derive/^(HZQ|HQZ|HG|HZ)/E/
    # - derive/^(hqz|hg|hz)/E/
    # - derive/^(HQ|hq)/A/

    - derive/^(JQZ?|J)/j/ #l
    # - derive/^L/l/
    # - derive/^SC/sc/
    # - derive/^ZC/zc/
##
    - derive/^(LZc)/j/
    - derive/^(LZ)/d/
    - derive/^([LRN]S)/th/
    - derive/^(C)[cr](.)/n$2/

    - derive/^(A)/hq/ #影母
    - derive/^(E)/hz/ #匣母
    - derive/^(C)/ng/ #疑母

    # - derive/^([tk]h[rc]|ts[sc]h)/tsrh/ #照組
    # - derive/^([tk][rc]|ts[sc])/tsr/
    # - derive/^([dg][rc])/dzr$1/
    # - derive/^(s[sc])/sr/
    # - derive/^(z[sc])/zr/
####
    - derive/^(kh|ng|k|g)[cq]/$1/
    - derive/^(th|t|d|n)[cr]/$1/

    - derive/^(tsh|ts|dz)[s]/$1/
    - derive/^([sz])[s]/$1/
    - derive/^h[gz]/g/
    - derive/^(tshc)/th/
    - derive/^(tsc)/t/
    - derive/^(dzc)/d/
####韻
##韻-介
    - derive/([\w])u(u[qAhs])$/$1i$2/ #uu
    - derive/([\w])vi(ə)/$1u$2/ #uə
    - derive/([\w])v(o[jlrndzt])/$1$2/ #von vo 
##韻-尾
    - derive/([\w][eovjxywarf]i)[Cc]/$1n/  #iŋ必
    - derive/([\w][eovjxywarf]i)g/$1d/
    - derive/([\w][eovjxywarf]i)x/$1z/

    # - derive/([\w][eov]a)j/$1/ #aj vuj  vu va
    # - derive/([\w][eov]u)j/$1/
    # - derive/([\w][xw]a)j/$1/ #aj iaj
    # - derive/([\w][eovjyxwarf]i)j/$1/ #ij
    # - derive/([\w][o]ʌ)j/$1/ #ʌj
    # - derive/([\w])([oe]u)v([qhsA])/$1$2$3/ #皋勹ov rov
    # - derive/([\w])([ar]u)v([qhsA])/$1$2$3/

    - derive/([aeiouəʌ;])j([qAhs])$/$1$2/
    - derive/([\w]u)v([qhsA])/$1$2/ #烋皋勹ov rov
    # - derive/([aeiouəʌ;])vq$/$1v/
    # - derive/([aeiouəʌ;])vA$/$1w/
    # - derive/([aeiouəʌ;])vs$/$1y/
    # - derive/([aeiouəʌ;])v(k)$/$1/ #-v-視爲韻

    - derive/([\w]o)ov$/$1əuq/ #ov 侯
    - derive/([\w]o)ow$/$1əuA/
    - derive/([\w]o)oy$/$1əus/
    - derive/([\w][ijx])ov$/$1iuq/ #ov 幽
    - derive/([\w][ijx])ow$/$1iuA/
    - derive/([\w][ijx])oy$/$1ius/
    - derive/([\w][ijx])əv$/$1uq/ #ov 尤
    - derive/([\w][ijx])əw$/$1uA/
    - derive/([\w][ijx])əy$/$1us/
####介
##
    - derive/([\w])o(a|o|ə|ʌ)/$1$2/ #一等无介音
    - derive/([\w])e(a|ə)/$1$2/ #e四等 
    - derive/([\w])(e)(a|e|i|u|ə)/$1$2/ #e四等 

    - abbrev/(\w)[jx]([aeiouəʌ;])/$1i$2/ #i=jxi
    - abbrev/(\w)[yw]([aeiouəʌ;])/$1u$2/ #i=jxi

    - derive/(\w)[jxi](i|ə|ʌ)/$1i/ #i
    - derive/(\w)[ywu](i|u|ə|ʌ)/$1u/ #u
##三等无介音
    # - xform/([\w])[oe]([aeiouəʌ;])/$1o$2/ #一三
    # - xform/([\w])[ij]([aeiouəʌ;])/$1$2/ #一三

    # - xform/([\w])x([aeiouəʌ;])/$1r$2/
##三等二分
    # - xform/(?<!^)i(ə|ʌ|a|e|i|o|u|;)/j$1/
    # - xform/(?<!^)u(ə|ʌ|a|e|i|o|u|;)/y$1/
    # - xform/(?<!^)x(ə|ʌ|a|e|i|o|u|;)/i$1/
    # - xform/(?<!^)w(ə|ʌ|a|e|i|o|u|;)/u$1/

###########
####補
    - derive/^(LZr?)([eovarfxw][aeiouəʌ;])/j$2/
    - derive/^(JX)([xw][aeiouəʌ;])/j$2/
    - derive/^(HZQ?|HQZ|XQZ?|XZ|QZ|E)([eovarf][aeiouəʌ;])/q$2/
    - derive/^(JQZ?)([jy][aeiouəʌ;])/q$2/

    # - derive/^(TSC)([jy])/k$2/
    # - derive/^(TSCH)([jy])/kh$2/
    # - derive/^(DZC)([jy])/g$2/

    - derive/^(hq?z)([eovarf][aeiouəʌ;])/q$2/
    - derive/^(tshc|tsch)([jy])/kh$2/
    - derive/^(tsc)([jy])/k$2/
    - derive/^(dzc)([jy])/g$2/
####聲-介
    - derive/^(JQZ|JQ|J)[ji]([aeiouəʌ;])/j\2/ #㠯母
    - derive/^(JXQ?|XQZ|QZ|X)u([aeiouəʌ;])/$1q$2/ #雲母
    - derive/^(JQZ|XQZ|QZ|XQ|JX|JQ|X)v(i[aeioəʌ;])/$1q$2/

    - derive/^MSv([ʌəo])/h$1/ #幫組 一三
    - derive/^(PH|P|B|M)F?v([aʌəei])/\L$1$2/

    # - derive/^(l)a([aeiouəʌ;])/l$2/
    # - derive/^(l)f/lv/
    # - derive/^(l)r/l/
    # - derive/^(l)f/lv/
    - derive/^(q)u([aeiouəʌ;])/q$2/ #雲母
    - derive/^(q)v(i[aeioəʌ;])/q$2/
    - derive/^(ph|p|b|m)v([aeiəʌ;])/$1$2/

####可選
    - derive/([\w][uyw]u)j$/$1/
##
    # - derive/([\w])vi([ouə])/$1u$2/ #uə
    # - derive/([\w])vx([uə])/$1w$2/ #
    # - derive/([\w])v([o])/$1$2/
##
    - derive/([\w])(v[ix]|[uyw])ə/$1u/ #iu- uo-
    - fuzz/([\w])[uyw]o([qhsA])/$1u$2/ #iu- uo-
    # - fuzz/([\w])[ijx]u([Ccgxk])/$1u$2/ #iu- io-
    # - fuzz/([\w])[ijx]o([Ccgxk])/$1u$2/
    # - fuzz/([\w])[ijx]u([qhsA])/$1u$2/
    # - fuzz/([\w])[ijx]o([mbfp])/$1u$2/
    # - fuzz/([\w])[ijx]u([mbfp])/$1u$2/
    - fuzz/([\w])[ijx][uo]/$1u/ #iu- io-
    - fuzz/([\w])[jxi]([oə]v|uq)$/$1iv/ #尤幽侯iv
    - fuzz/([\w])[jxi]([oə]w|uA)$/$1iw/
    - fuzz/([\w])[jxi]([oə]y|us)$/$1iy/
####尾
    - derive/([aeiouəʌ;])['q]$/$1/
    - derive/(?<!^)A$/h/
    - derive/(?<!^)C$/c/
    # - derive/(?<!^)A$/hq/
    # - derive/(?<!^)C$/ng/
    - abbrev/(?<!^)j['q]$/j/
    - abbrev/(?<!^)jA$/l/
    - abbrev/(?<!^)js$/r/
    - derive/(?<!^)vq$/v/
    - derive/(?<!^)vA$/w/
    - derive/(?<!^)vsk?/y/
    - derive/(?<!^)vs(k)/y$1/

    - xform/(vs|[sry])[ptk]$/$1/ # 韻尾-聲調
    - derive/(?<!^)v(k)$/$1/
####補
    - derive/([\w])vio([qhsA])/$1ua$2/ #ua uo魚
    - derive/([\w]v?[ijx])o([qhsA])/$1a$2/
##
    # - fuzz/([iu])(a)/$2$1/
    # - fuzz/(a)([iu])/$2$1/
    - fuzz/([aiu])([aeiouəʌ;])([qAhsjlrvwymbfpndztCcgxk])/$2$1$3/ #介元序 无eo
    - fuzz/(?<!^)([fvjyxw])([aeiou]|ə|ʌ)([qAhsjlrvwymbfpndztCcgxk])/$2$1$3/
    - fuzz/(?<!^)x([aeiouəʌ;])/r$1/ #l=x
    - fuzz/(?<!^)a([aeiouəʌ;])/l$1/ #r=a
    - fuzz/(?<!^)([rl])([aeiou]|ə|ʌ)([qAhsjlrvwymbfpndztCcgxk])/$2$1$3/ #l=x
    # - fuzz/(?<!^)(a)([aeiouəʌ;])/$2l/ #qAhsjlrvwymbfpndztCcgxk
    # - fuzz/(?<!^)(x)([aeiouəʌ;])([.])/$2r$3/
####轉寫
    - derive/(ʌ|ə)/;/ #EOə eo
    - derive/ʌ/ea/ #EOə eo
    - derive/ə/eo/ #EOə eo
    # - derive/A/hq/
    # - derive/C/ng/
    # - derive/E/hz/
####聲𥳑
    - derive/^sc([jy])/h$1/ #船
    - derive/^zc([jy])/q$1/ #書
    - derive/^dz(?!c)/z/

    - derive/^ph/f/
    - derive/^th/r/
    - derive/^kh/y/
    - derive/^ts(s?)h/v$1/
    - derive/^ts(?!c)/x/
    - derive/^(hq)/w/
    - derive/^(ng)/c/

    - derive/^dzr/z/  #照
    - derive/^tsr/w/
####𥳑
    # - abbrev/^(\w).+$/$1/
    # - abbrev/^(\w[zhcqs]?[lrfvjyxw]).+$/$1/ #介
    # - abbrev/^(tsh?|dz).+$/$1/
    # - abbrev/^([ptkw]h).+$/$1/
    # - abbrev/^(sz).+$/$1/
    # - abbrev/^([sz]c).+$/$1/
    # - abbrev/^(hz|hq).+$/$1/
    # - abbrev/^(ng).+$/$1/

    # - erase/^[a-z][zhcgqs].+$/
    - abbrev/^([a-z])[^zhcgqsrl].*$/$1/ #𥳑

translator:
  dictionary: hzeepquuns
  # prism: hzeepquuns
  spelling_hints: 10
  preedit_format:
    - xform/;/ə/
    # - xform/(^|')r/$1th/
    # - xform/(^|')f/$1ph/
    # - xform/(^|')v/$1tsh/
    # - xform/(^|')y/$1kh/
    # - xform/(^|')w/$1ts/
    # - xform/(^|')x/$1ŋ/
    # - xform/(^|')w/$1ʔ/
    # - xform/ea/ʌ/
    # - xform/hq/ʔ/
    # - xform/ng/ŋ/
    # - xform/hz/ɦ/
    # - xform/([aeiouəʌ;])h($|')/$1ʔ$2/
    # - xform/([aeiouəʌ;])c($|')/$1ŋ$2/
    # - xform/([aeiouəʌ;])g($|')/$1ŋʔ$2/
    # - xform/([aeiouəʌ;])x($|')/$1ŋs$2/
    # - xform/([aeiouəʌ;])b($|')/$1mʔ$2/
    # - xform/([aeiouəʌ;])f($|')/$1ms$2/
    # - xform/([aeiouəʌ;])d($|')/$1nʔ$2/
    # - xform/([aeiouəʌ;])z($|')/$1ns$2/
    # - xform/([aeiouəʌ;])w($|')/$1vʔ$2/
    # - xform/([aeiouəʌ;])y($|')/$1vs$2/
    # - xform/([aeiouəʌ;])l($|')/$1jʔ$2/
    # # - xform/([aeiouəʌ;])r($|')/$1js$2/

    # - xform/HG/ʁ/
    # - xform/XZ/ɣ/
    # - xform/XZQ/ʁ/
    # - xform/XSQ/ʁ/
    # - xform/NGQ/ɴ/
    # - xform/QZ/ɢ/
    # - xform/A/ʔ/
    # - xform/E/ɦ/
    # - xform/NR/ɳ/
    # - xform/SS/ʃ/
    # - xform/SC/ɕ/
    # - xform/ZC/ʑ/
    # - xform/ZS/ʒ/
    # - xform/SR/ʂ/
    # - xform/ZR/ʐ/
    # - xform/TSC/t͡ɕ/
    # - xform/DZC/d͡ʑ/
    # - xform/TSS/t͡ʃ/
    # - xform/DZS/d͡ʒ/
    # - xform/TSR/t͡ʂ/
    # - xform/DZR/d͡ʐ/
    # - xform/PF/p͡ɸ/
    # - xform/BF/B͡β/
    # - xform/MF/ɱ/
    # - xform/TR/ʈ/
    # - xform/DR/ɖ/
    # - xform/([A-Z])O/$1ˤ/
    # - xform/([A-Z])V/$1ʷ/
    # - xform/(.+)H/\L$1ʰ/
    # - xform/([aeiouəʌ;])q($|')/$1 $2/
  comment_format:
    - xform/A/ʔ/
    - xform/E/ɦ/
    - xform/(HXS|HSQ|HQS|NGS|CS|MS|[XH]S|SX|QS)/h/
    - xform/(LZ)/d/
    - xform/([LRN]S)/th/
    - xform/(HQZ|XQZ|JXQ?|XZ|QZ|X)/q/
    - xform/NG|C|c($|')/ŋ$1/
    - xform/F//
    - xform/([A-Z])/\L\1/
    # - xform/([rs])[ptk]$/$1/
  initial_quality: 0.7

pinyin:
  dictionary: luna_pinyin
  prism: luna_quanpin
  enable_completion: false
  prefix: "~"
  suffix: "'"
  tips: 〔pinyin〕
  tag: pinyin
  # closing_tips:
  # # contextual_suggestions: 
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue('|$)/$1üe$2/
    - xform/([jqxy])v/$1ü/
  initial_quality: 0.1	# 調整該編譯器出字優先度

cangjie6:
  dictionary: cangjie6
  prism: cangjie6
  enable_charset_filter: false
  enable_sentence: false
  enable_encoder: false
  encode_commit_history: false
  # enable_completion: false
  enable_user_dict: false
  prefix: "`"
  suffix: "'"
  tips: 〔倉頡6〕
  tag: cangjie6
  # closing_tips:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|
  comment_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片～|"
  initial_quality: 0.2

abc_segmentor: #混用 不𥳑拼不連打
  extra_tags: [pinyin, cangjie6]

lookp:
  tags: [pinyin,cangjie6]
  dictionary: hzeepquuns
  overwrite_comment: false
  comment_format:
    - xform/A/ʔ/
    - xform/E/ɦ/
    - xform/(HXS|HSQ|HQS|NGS|CS|MS|[XH]S|SX|QS)/h/
    - xform/(LZ)/d/
    - xform/([LRN]S)/th/
    - xform/(HQZ|XQZ|JXQ?|XZ|QZ|X)/q/
    - xform/NG|C|c($|')/ŋ$1/
    - xform/F//
    - xform/([A-Z])/\L\1/
    # - xform/([rs])[ptk]$/$1/
punctuator:
  import_preset: symbols
key_binder:
  import_preset: default
  bindings:
ascii_composer:
    good_old_caps_lock: true
    switch_key: {Caps_Lock: noop, Control_L: noop, Control_R: noop, Eisu_toggle: clear, Shift_L: commit_code, Shift_R: commit_code}

recognizer:
  import_preset: default
  patterns:
    email: "^[a-z][-_.0-9a-z]*@.*$"
    # punct: '^/([0-9]0?|[A-Za-z]+)$' #配合symbols.yaml中的特殊字符輸入
    punct: "^/[0-9a-zA-Z]*$" #配合symbols.yaml中的特殊字符輸入
    pinyin: "^~[a-z]*'?$"
    cangjie6: "^`[a-z]*'?$"
